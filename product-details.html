<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Product Details" />
    <meta name="author" content="" />
    <title>Product Details - Start Bootstrap</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="css/styles.css" rel="stylesheet" />
    <!-- Inline CSS for modern styling -->
    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #f8fafc 0%, #e3e9f3 40%, #f7d9e3 80%, #c3e0f7 100%);
            background-attachment: fixed;
            animation: bgMove 18s ease-in-out infinite alternate;
        }
        @keyframes bgMove {
            0% {background-position: 0% 50%;}
            50% {background-position: 100% 50%;}
            100% {background-position: 0% 50%;}
        }
        .navbar, .footer-modern {
            background: linear-gradient(to right, #1a1a1a, #2c3e50) !important;
            color: #fff;
        }
        .navbar .nav-link, .navbar .navbar-brand, .navbar .btn {
            color: #fff !important;
        }
        .navbar .nav-link.active, .navbar .nav-link:focus, .navbar .nav-link:hover {
            color: #ffd700 !important;
        }
        .header {
            background: linear-gradient(120deg, #2c3e50 0%, #1a1a1a 100%);
            color: #fff;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 8px 32px rgba(44,62,80,0.15);
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(270deg, #2c3e50, #1a1a1a, #2c3e50, #1a1a1a);
            background-size: 400% 400%;
            opacity: 0.5;
            z-index: 0;
            animation: gradientMove 8s ease-in-out infinite;
        }
        @keyframes gradientMove {
            0% {background-position: 0% 50%;}
            50% {background-position: 100% 50%;}
            100% {background-position: 0% 50%;}
        }
        .header .container {
            position: relative;
            z-index: 1;
        }
        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            letter-spacing: 2px;
            animation: fadeInDown 1.2s cubic-bezier(.77,0,.18,1) both;
        }
        .header p {
            font-size: 1.5rem;
            color: #e0e0e0;
            margin-bottom: 2rem;
            animation: fadeInUp 1.5s cubic-bezier(.77,0,.18,1) 0.5s both;
        }
        @keyframes fadeInDown {
            0% {opacity:0; transform:translateY(-40px);}
            100% {opacity:1; transform:translateY(0);}
        }
        @keyframes fadeInUp {
            0% {opacity:0; transform:translateY(40px);}
            100% {opacity:1; transform:translateY(0);}
        }
        .btn-primary {
            background: linear-gradient(90deg, #007bff, #00b4ff);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
        }
        .btn-danger {
            background: linear-gradient(90deg, #dc3545, #ff4560);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        /* Footer Modern Styles */
        .footer-modern {
            background-color: #1a1a1a;
            color: #fff;
            padding: 3rem 0;
        }
        .footer-modern h5, .footer-modern h6 {
            color: #ffd700;
        }
        .footer-modern a {
            color: #fff;
            transition: color 0.3s;
        }
        .footer-modern a:hover {
            color: #ffd700;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light" style="background: linear-gradient(to right, #1a1a1a, #2c3e50); color: #fff;">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand fw-bold" style="color:#fff;" href="index.html">Springcart</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
                    <li class="nav-item"><a class="nav-link" style="color:#fff;" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" style="color:#fff;" href="About.html">About</a></li>
                    <li class="nav-item"><a class="nav-link" style="color:#fff;" href="New-Arrivals.html">New Arrivals</a></li>
                    <li class="nav-item d-none" id="addProductContainer">
                        <a id="addProductBtn" class="nav-link" style="color:#fff;" href="add-product.html">Add Product</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <!-- Cart Button -->
                    <a class="btn btn-outline-dark me-2" href="Cart.html">
                        <i class="bi-cart-fill me-1"></i>
                        Cart
                        <span class="badge bg-dark text-white ms-1 rounded-pill" id="cart-badge">0</span>
                    </a>
                    <!-- Auth/User Profile -->
                    <div id="authContainer" class="d-flex align-items-center">
                        <a href="/oauth2/authorization/google" id="signInButton" class="btn btn-gradient-signin d-flex align-items-center" style="padding: 0.5rem 1.2rem; font-weight: 600; border-radius: 2rem; background: linear-gradient(90deg, #ff9800 0%, #ff5722 100%); color: #fff; box-shadow: 0 2px 8px rgba(255,152,0,0.15); border: none; transition: background 0.3s, box-shadow 0.3s;">
                            <i class="bi bi-box-arrow-in-right me-2"></i> Sign In
                        </a>
                        <div id="userProfile" class="d-none">
                            <div class="d-flex align-items-center">
                                <img id="userImage" src="" alt="Profile" class="rounded-circle me-2" style="width: 40px; height: 40px; object-fit: cover;">
                                <div class="d-flex flex-column">
                                    <div class="d-flex align-items-center">
                                        <span id="userName" class="fw-bold text-white" style="font-size: 0.9rem;"></span>
                                        <span id="adminBadge" class="ms-2 badge bg-warning text-dark d-none" style="font-size: 0.7rem;">
                                            <i class="bi bi-shield-fill"></i> ADMIN
                                        </span>
                                        <span id="userBadge" class="ms-2 badge bg-info text-dark" style="font-size: 0.7rem;">
                                            <i class="bi bi-person-fill"></i> USER
                                        </span>
                                    </div>
                                    <a href="http://localhost:8080/logout" class="text-white-50" style="font-size: 0.8rem; text-decoration: none;">Logout</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <!-- Header -->
    <header class="header py-5">
        <div class="container px-4 px-lg-5 my-5">
            <div class="text-center text-white">
                <h1 class="display-4 fw-bolder">Product Details</h1>
                <p class="lead fw-normal text-white-50 mb-0">Explore Your Selected Item</p>
            </div>
        </div>
    </header>
    <!-- Product Section -->
    <section class="py-5">
        <div class="container px-4 px-lg-5 my-5">
            <div class="row gx-4 gx-lg-5 align-items-center">
                <div class="col-md-6">
                    <img id="productImage" class="card-img-top mb-5 mb-md-0" src="https://dummyimage.com/600x700/dee2e6/6c757d.jpg" alt="Product" />
                </div>
                <div class="col-md-6">
                    <div class="small mb-1" id="sku">SKU: Loading...</div>
                    <div class="small mb-1" id="brandName">Brand: Loading...</div>
                    <h1 class="display-5 fw-bolder" id="productName">Loading...</h1>
                    <div class="fs-5 mb-5">
                        <span class="text-decoration-line-through" id="oldPrice">$0.00</span>
                        <span id="productPrice">$0.00</span>
                    </div>
                    <p class="lead" id="productDescription">Loading description...</p>
                    <div class="d-flex gap-2 mb-3">
                        <input class="form-control text-center me-2" id="inputQuantity" type="number" value="1" style="max-width: 4rem" />
                        <button class="btn btn-primary flex-shrink-0" type="button">
                            <i class="bi-cart-fill me-1"></i>
                            Add to Cart
                        </button>
                    </div>
                    <div class="d-flex gap-2 d-none" id="adminControls">
                        <a href="#" id="updateButton" class="btn btn-primary flex-shrink-0">
                            <i class="bi-pencil-fill me-1"></i>
                            Update Product
                        </a>
                        <button id="deleteButton" class="btn btn-danger flex-shrink-0">
                            <i class="bi-trash-fill me-1"></i>
                            Delete Product
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer Modern -->
    <footer class="footer-modern">
        <div class="container">
            <div class="row">
                <div class="col-md-6 mb-3 mb-md-0">
                    <h5>About SpringCart</h5>
                    <p class="mb-1">Your one-stop shop for all things trendy and essential. We bring you the best products at unbeatable prices.</p>
                </div>
                <div class="col-md-3 mb-2 mb-md-0">
                    <h6>Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="New-Arrivals.html">New Arrivals</a></li>
                        <li><a href="About.html">About</a></li>
                        <li><a href="add-product.html">Add Product</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Contact</h6>
                    <p class="mb-1">Email: debangshubhattacharya4@gmail.com</p>
                    <p>Phone: +91 12345 67890</p>
                </div>
            </div>
            <hr style="background:rgba(255,255,255,0.2);">
            <p class="m-0 text-center">&copy; Springcart 2025. All rights reserved.</p>
        </div>
    </footer>
    <!-- Snackbar/Toast Notification -->
    <div id="snackbar" style="visibility:hidden; min-width:250px; background:#323232; color:#fff; text-align:center; border-radius:8px; padding:16px; position:fixed; z-index:9999; left:50%; bottom:30px; font-size:17px; transform:translateX(-50%); box-shadow:0 4px 16px rgba(0,0,0,0.15);"></div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS -->
    <script src="js/scripts.js"></script>
    <!-- Login Status Notification Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const signInButton = document.getElementById('signInButton');
        const userProfile = document.getElementById('userProfile');
        const userImage = document.getElementById('userImage');
        const userName = document.getElementById('userName');
        const adminBadge = document.getElementById('adminBadge');

        // Check login status
        fetch('http://localhost:8080/api/auth/status', {
            credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
            if (data.authenticated) {
                // Only show notification if this is the first login
                const hasShownWelcome = localStorage.getItem('welcomeShown');
                if (!hasShownWelcome) {
                    showNotification('Successfully logged in as ' + data.name, 'success');
                    localStorage.setItem('welcomeShown', 'true');
                }

                signInButton.classList.add('d-none');
                userProfile.classList.remove('d-none');
                userImage.src = data.imageUrl || 'https://via.placeholder.com/40';
                userName.textContent = data.name;

                // Check if user is admin
                fetch('http://localhost:8080/api/user/role', {
                    credentials: 'include',
                    headers: {
                        "Accept": "text/plain"
                    }
                })
                .then(res => res.text())
                .then(role => {
                    if (role === "ROLE_ADMIN") {
                        adminBadge.classList.remove('d-none');
                        document.getElementById('userBadge').classList.add('d-none');
                    }
                });

            } else {
                signInButton.classList.remove('d-none');
                userProfile.classList.add('d-none');
                // Clear the welcome flag when logged out
                localStorage.removeItem('welcomeShown');
            }
        })
        .catch(error => {
            console.error('Auth check failed:', error);
            // Only show error notification for authentication failures
            if (!localStorage.getItem('welcomeShown')) {
                showNotification('Failed to check login status', 'error');
            }
        });
    });

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            background-color: ${type === 'success' ? '#4CAF50' : '#f44336'};
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            animation: slideIn 0.5s ease-out;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);

        // Add slide-in animation
        const keyframes = `
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    `;
    const styleSheet = document.createElement("style");
    styleSheet.textContent = keyframes;
    document.head.appendChild(styleSheet);

    setTimeout(() => {
        notification.style.transition = 'all 0.5s ease-in';
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => notification.remove(), 500);
    }, 5000);
}
    </script>
    <!-- Cart Count Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fetch cart count and update badge
        fetch('http://localhost:8080/api/cart', { credentials: 'include' })
            .then(res => {
                if (!res.ok) return [];
                return res.json();
            })
            .then(items => {
                const badge = document.getElementById('cart-badge');
                if (badge && Array.isArray(items)) {
                    badge.textContent = items.length;
                }
            })
            .catch(() => {
                // On error, leave badge as 0
            });
    });
    </script>
    <!-- Fetch API Script -->
    <script>
        // Snackbar/toast function
        function showSnackbar(message, isError = false) {
            const sb = document.getElementById('snackbar');
            sb.textContent = message;
            sb.style.background = isError ? '#d32f2f' : '#323232';
            sb.style.visibility = 'visible';
            sb.style.opacity = '1';
            setTimeout(() => {
                sb.style.transition = 'opacity 0.5s';
                sb.style.opacity = '0';
                setTimeout(() => {
                    sb.style.visibility = 'hidden';
                    sb.style.transition = '';
                }, 500);
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            if (productId) {
                // Fixed: Changed the endpoint URL to match the ProductController endpoint
                fetch(`http://localhost:8080/api/productdetails/${productId}`, {
                    credentials: 'include'
                })
                .then(res => {
                    if (!res.ok) throw new Error('Network response was not ok');
                    return res.json();
                })
                .then(product => {
                    // Update product details in the DOM
                    document.getElementById('productName').textContent = product.name;
                    document.getElementById('productPrice').textContent = `$${product.price.toFixed(2)}`;
                    document.getElementById('oldPrice').textContent = `$${(product.price * 1.2).toFixed(2)}`;
                    document.getElementById('productDescription').textContent = product.description || 'No description available';
                    document.getElementById('sku').textContent = `SKU: PROD-${product.id}`;
                    document.getElementById('brandName').textContent = `Brand: ${product.brand || 'Not Available'}`;

                    // Set product image with error handling
                    const productImage = document.getElementById('productImage');
                    productImage.src = `http://localhost:8080/api/product/${product.id}/image`;
                    productImage.alt = product.name;
                    productImage.onerror = function() {
                        this.src = 'https://dummyimage.com/600x700/dee2e6/6c757d.jpg';
                    };

                    // Update update button href if it exists
                    const updateButton = document.getElementById('updateButton');
                    if (updateButton) {
                        updateButton.href = `update-product.html?id=${product.id}`;
                    }
                })
                .catch(error => {
                    console.error('Error fetching product:', error);
                    showSnackbar('❌ Failed to load product details', true);
                });
            } else {
                showSnackbar('❌ No product ID provided', true);
            }
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Fetch user role
            fetch("http://localhost:8080/api/user/role", {
                credentials: "include",
                headers: {
                    "Accept": "text/plain"
                }
            })
            .then(res => res.text())
            .then(role => {
                const isAdmin = role === "ROLE_ADMIN";
                // Show/hide admin controls
                document.getElementById("adminControls").classList.toggle("d-none", !isAdmin);

                // Hide cart functionality for admins
                const cartButton = document.querySelector('.btn-primary.flex-shrink-0');
                const quantityInput = document.getElementById('inputQuantity');
                if (cartButton && isAdmin) {
                    cartButton.style.display = 'none';
                    quantityInput.style.display = 'none';
                }
            })
            .catch(err => {
                console.error("Failed to fetch user role:", err);
            });
        });
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add click handler to the Add to Cart button
        document.querySelector('.btn-primary.flex-shrink-0').addEventListener('click', async () => {
            // First check if user is authenticated
            try {
                const authResponse = await fetch('http://localhost:8080/api/auth/status', {
                    credentials: 'include'
                });
                const authData = await authResponse.json();

                if (!authData.authenticated) {
                    // If not authenticated, redirect to login
                    window.location.href = '/oauth2/authorization/google';
                    return;
                }

                // If authenticated, proceed with adding to cart
                const productId = new URLSearchParams(window.location.search).get('id');
                const quantity = parseInt(document.getElementById('inputQuantity').value);

                const res = await fetch(`http://localhost:8080/api/cart/add?productId=${productId}&quantity=${quantity}`, {
                    method: 'POST',
                    credentials: 'include'
                });

                if (!res.ok) {
                    throw new Error(await res.text());
                }

                const addedItem = await res.json();
                showSnackbar(`🛒 Added ${addedItem.product.name} x ${addedItem.quantity} to your cart!`);

            } catch (err) {
                console.error('Error:', err);
                showSnackbar('❌ ' + err.message, true);
            }
        });
    });
    </script>
    <script>
    // Add event listener for delete button
    document.getElementById('deleteButton')?.addEventListener('click', async function() {
        if (!confirm('Are you sure you want to delete this product?')) {
            return;
        }

        const productId = new URLSearchParams(window.location.search).get('id');

        try {
            const response = await fetch(`http://localhost:8080/api/product/${productId}`, {
                method: 'DELETE',
                credentials: 'include'
            });

            if (!response.ok) {
                throw new Error('Failed to delete product');
            }

            showSnackbar('✅ Product deleted successfully');
            // Redirect to home page after successful deletion
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1500);

        } catch (error) {
            console.error('Error:', error);
            showSnackbar('❌ Failed to delete product', true);
        }
    });
    </script>

</body>
</html>
